#!/bin/bash

# Go to this directory
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
MARKER='\033[1m[PACKMAN]\033[0m'
cd $DIR

which yum 2> /dev/null >&2
if [ $? -eq 0 ]; then
    MODE="yum"
else
    echo -e "$MARKER Could not find yum installed on this machine..."
    exit 1
fi

if [ $# -lt 2 ]; then
    echo "Usage: "
    echo "  packman [search|install|get] package"
    echo ""
    echo "  search package:"
    echo "		Display the search result for a package"
    echo ""
    echo "  install packages:"
    echo "		Installs a given package"
    echo ""
    echo ""
    echo "  get packages:"
    echo "		Downloads a given package but doesn't install it"
    echo ""
    exit 1
fi

case $1 in
    search)
        if [ "$MODE" = "yum" ]; then
            yum search $2
        fi
        ;;
    install)
        shift
        for package in $*; do
        echo -e "$MARKER Installing $package from $MODE..."
            if [ "$MODE" = "yum" ]; then
                rm -rf rpm
                mkdir rpm &&
                cd rpm &&
                yumdownloader $package &&
                cd .. &&
                rpm2cpio rpm/*.rpm | cpio -idmvu
            fi
        done
        ;;
    get)
        if [ "$MODE" = "yum" ]; then
            yum search $2
        fi
        ;; 
    *)
        echo -e "$MARKER Unknown instruction $1"
        ;;
esac
